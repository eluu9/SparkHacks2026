{% extends "base.html" %}

{% block content %}
<div class="auth-container">
    <div class="auth-card chat-bubble-anim">
        <div class="text-center mb-4">
            <h3 class="fw-bold text-dark">Welcome back, Taha</h3>
            <p class="text-muted small">Sign in to sync your AI shopping kits</p>
        </div>

        <button id="login-btn" class="btn btn-outline-dark w-100 btn-pill d-flex align-items-center justify-content-center gap-2 mb-4">
            <img src="https://upload.wikimedia.org/wikipedia/commons/5/53/Google_%22G%22_Logo.svg" width="18">
            Continue with Google
        </button>

        <div class="position-relative mb-4">
            <hr class="text-muted opacity-25">
            <span class="position-absolute top-50 start-50 translate-middle bg-white px-3 text-muted small">Secure Auth</span>
        </div>

        <p class="text-center small text-muted">
            New to the lab? <a href="/auth/signup" class="text-dark fw-bold text-decoration-none">Create an account</a>
        </p>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script type="module">
    // Your verified Firebase configuration
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
    import { getAuth, signInWithPopup, GoogleAuthProvider } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js";
    
    const firebaseConfig = {
        apiKey: "AIzaSyCrDraVHDBhnQNFMq4JkqNffCQuA4O9FpI",
        authDomain: "sparkhacks-b2985.firebaseapp.com",
        projectId: "sparkhacks-b2985",
        storageBucket: "sparkhacks-b2985.firebasestorage.app",
        messagingSenderId: "399492923349",
        appId: "1:399492923349:web:be15e8843340026c70075c",
        measurementId: "G-09JS9YQS93"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth();
    const provider = new GoogleAuthProvider();

    // Hooking the modern button to your Firebase logic
    document.getElementById('login-btn').addEventListener('click', () => {
        signInWithPopup(auth, provider).then((result) => {
            result.user.getIdToken().then((idToken) => {
                fetch('/auth/session-login', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ idToken: idToken })
                }).then(res => res.json()).then(data => {
                    if(data.status === 'success') {
                        // Success redirect back to the chat dashboard
                        window.location.href = '/';
                    }
                });
            });
        }).catch((error) => {
            console.error("Auth Error:", error);
        });
    });
</script>
{% endblock %}